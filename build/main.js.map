{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["/**\n * ioBroker DS18B20 1-wire temperature sensor adapter.\n *\n * (C) 2019-2023 Peter M\u00FCller <peter@crycode.de> (https://github.com/crycode-de/ioBroker.ds18b20)\n */\n\nimport 'source-map-support/register';\n\nimport { promisify } from 'util';\n\nimport * as fs from 'fs';\nconst readFile = promisify(fs.readFile);\nconst readDir = promisify(fs.readdir);\n\nimport * as crypto from 'crypto';\n\nimport {\n  Adapter,\n  AdapterOptions,\n  EXIT_CODES,\n} from '@iobroker/adapter-core';\n\nimport { boundMethod } from 'autobind-decorator';\n\nimport { Sensor } from './sensor';\n\nimport { RemoteSensorServer } from './remote-server';\n\n/**\n * The ds18b20 adapter.\n */\nclass Ds18b20Adapter extends Adapter {\n\n  /**\n   * Mapping of the ioBroker object IDs to the sensor class instances.\n   */\n  private sensors: Record<string, Sensor> = {};\n\n  /**\n   * The server for remote sensors if enabled.\n   */\n  public remoteSensorServer: RemoteSensorServer | null = null;\n\n  /**\n   * Constructor to create a new instance of the adapter.\n   * @param options The adapter options.\n   */\n  public constructor(options: Partial<AdapterOptions> = {}) {\n    super({\n      ...options,\n      name: 'ds18b20',\n    });\n\n    this.on('ready', this.onReady);\n    this.on('stateChange', this.onStateChange);\n    this.on('message', this.onMessage);\n    this.on('unload', this.onUnload);\n  }\n\n  /**\n   * Is called when databases are connected and adapter received configuration.\n   */\n  @boundMethod\n  private async onReady(): Promise<void> {\n    // Reset the connection indicator during startup\n    this.setState('info.connection', false, true);\n\n    // set default devices path if not defined\n    if (!this.config.w1DevicesPath) {\n      this.config.w1DevicesPath = '/sys/bus/w1/devices';\n    }\n\n    // need to upgrade config from old version (<2.0.0)?\n    if (Object.keys(this.config).includes('_values')) {\n      this.log.info('Migrate config from old version ...');\n      const instanceObj = await this.getForeignObjectAsync(`system.adapter.${this.namespace}`);\n      if (!instanceObj) {\n        this.log.error('Could not read instance object!');\n        this.terminate('Config migration required', EXIT_CODES.INVALID_ADAPTER_CONFIG);\n        return;\n      }\n\n      const oldNative: ioBroker.AdapterConfigV1 = instanceObj.native as ioBroker.AdapterConfigV1;\n\n      // log a warning to inform the user to re-install the remote clients if remote is enabled\n      if (oldNative.remoteEnabled) {\n        this.log.warn(`Please make sure to re-install you remote clients, or they won't be able to connect!`);\n      }\n\n      const newNative: ioBroker.AdapterConfig = {\n        defaultInterval: oldNative.defaultInterval,\n        remoteEnabled: oldNative.remoteEnabled,\n        remoteKey: oldNative.remoteKey,\n        remotePort: oldNative.remotePort,\n        w1DevicesPath: oldNative.w1DevicesPath,\n        sensors: [],\n      };\n\n      // migrate sensors\n      for (const oldSensor of oldNative._values) {\n        const { obj, ...sensor } = oldSensor;\n        newNative.sensors.push(sensor);\n\n        // TODO: remove native part from the sensor object\n        /*const sensorObj = await this.getForeignObjectAsync(obj._id);\n        if (sensorObj) {\n          sensorObj.native = {};\n          await this.setForeignObjectAsync(obj._id, sensorObj);\n        }*/\n      }\n\n      instanceObj.native = newNative;\n      this.log.info('Rewriting adapter config');\n      this.setForeignObjectAsync(`system.adapter.${this.namespace}`, instanceObj);\n      this.terminate('Restart adapter to apply config changes', EXIT_CODES.START_IMMEDIATELY_AFTER_STOP);\n      return;\n    }\n\n    // remote sensor server\n    if (this.config.remoteEnabled) {\n      // check decrypt native support and show a warning in case of unsupported\n      if (this.supportsFeature && !this.supportsFeature('ADAPTER_AUTO_DECRYPT_NATIVE')) {\n        this.log.warn('The server for remote sensors is enabled but decrypt native is not supported! The encryption key will be stored unencrypted in the ioBroker database. To get decrypt native support, please upgrade js-controller to v3.0 or greater.');\n      }\n\n      // check the port\n      if (!this.config.remotePort || this.config.remotePort <= 0) {\n        this.log.warn('Config: Invalid port for the remote sensor server! Using default port 1820.');\n        this.config.remotePort = 1820;\n      }\n\n      // check the key\n      if (typeof this.config.remoteKey !== 'string' || this.config.remoteKey.length !== 64) {\n        this.config.remoteKey = crypto.randomBytes(32).toString('hex');\n        this.log.error(`Config: Invalid key for the remote sensor server! Using random key \"${this.config.remoteKey}\".`);\n      }\n\n      this.remoteSensorServer = new RemoteSensorServer(this.config.remotePort, this.config.remoteKey, this);\n\n      this.remoteSensorServer.on('listening', () => {\n        this.log.info(`Remote sensor server is listening on port ${this.config.remotePort}`);\n        this.updateInfoConnection();\n      });\n\n      this.remoteSensorServer.on('error', (err: Error) => {\n        this.log.warn(`Remote sensor server error: ${err.toString()}`);\n        this.log.debug(`${err.toString()} ${err.stack}`);\n        this.updateInfoConnection();\n      });\n    }\n\n    // setup sensors\n    this.getForeignObjects(this.namespace + '.sensors.*', 'state', (err, objects) => {\n      if (err) {\n        this.log.error('error loading sensors data objects');\n        return;\n      }\n\n      for (const objectId in objects) {\n        const obj: SensorObject = objects[objectId] as SensorObject;\n\n        if (typeof obj.native?.address !== 'string') {\n          this.log.warn(`Object ${obj._id} has no valid address!`);\n          continue;\n        }\n\n        if (obj.native.enabled === false) {\n          this.log.debug(`Sensor ${obj.native.address} is not enabled and will be ignored.`);\n          continue;\n        }\n\n        if (obj.native.remoteSystemId && !this.config.remoteEnabled) {\n          this.log.warn(`Sensor ${obj.native.address} is configured as remote sensor of ${obj.native.remoteSystemId} but remote sensors are not enabled!`);\n          continue;\n        }\n\n        this.sensors[obj._id] = new Sensor({\n          w1DevicesPath: this.config.w1DevicesPath,\n          id: obj._id,\n          address: obj.native.address,\n          interval: typeof obj.native.interval === 'number' ? obj.native.interval : this.config.defaultInterval,\n          nullOnError: !!obj.native.nullOnError,\n          factor: typeof obj.native.factor === 'number' ? obj.native.factor : 1,\n          offset: typeof obj.native.offset === 'number' ? obj.native.offset : 0,\n          decimals: typeof obj.native.decimals === 'number' ? obj.native.decimals : null,\n          remoteSystemId: typeof obj.native.remoteSystemId === 'string' ? obj.native.remoteSystemId : null,\n        }, this);\n        this.sensors[obj._id].on('value', this.handleSensorValue);\n        this.sensors[obj._id].on('error', this.handleSensorError);\n        this.sensors[obj._id].on('errorStateChanged', this.handleSensorErrorStateChanged);\n      }\n\n      this.log.debug(`loaded ${Object.keys(this.sensors).length} sensors`);\n    });\n\n    // subscribe needed states\n    this.subscribeStates('actions.*');\n  }\n\n  /**\n   * Is called when adapter shuts down - callback has to be called under any circumstances!\n   */\n  @boundMethod\n  private async onUnload(callback: () => void): Promise<void> {\n    try {\n      // stop all intervals from the sensors\n      for (const address in this.sensors) {\n        this.sensors[address].stop();\n      }\n\n      // stop the remote sensor server\n      if (this.remoteSensorServer) {\n        await this.remoteSensorServer.stop();\n      }\n\n      // reset connection state\n      await this.setStateAsync('info.connection', false, true);\n\n    } catch(e) { }\n\n    callback();\n  }\n\n  /**\n   * Handler for incoming sensor values.\n   * @param value The value or null in case of an error.\n   * @param id    The ioBroker ID of the sensor.\n   */\n  @boundMethod\n  private handleSensorValue (value: number | null, id: string): void {\n    if (!this.sensors[id]) return;\n\n    this.log.debug(`got value ${value} from sensor ${this.sensors[id].address}`);\n\n    if (value === null) {\n      this.setStateAsync(id, {\n        ack: true,\n        val: null,\n        q: 0x81, // general problem by sensor\n      });\n    } else {\n      this.setStateAsync(id, {\n        ack: true,\n        val: value,\n      });\n    }\n  }\n\n  /**\n   * Handler for sensor errors.\n   * @param err The error.\n   * @param id  The ioBroker ID of the sensor.\n   */\n  @boundMethod\n  private handleSensorError (err: Error, id: string): void {\n    this.log.warn(`Error reading sensor ${this.sensors[id].address}: ${err}`);\n  }\n\n  /**\n   * Handler for changes of error state of a sensor.\n   * This will change the info.connection state of the adapter to true if all\n   * sensors are ok and false if at least one sensor has an error.\n   * @param hasError Indicator if the sensor has an error or not.\n   * @param id       The ioBroker ID of the sensor.\n   */\n  @boundMethod\n  private handleSensorErrorStateChanged (hasError: boolean, id: string): void {\n    this.log.debug(`error state of sensor ${this.sensors[id].address} changed to ${hasError}`);\n\n    this.updateInfoConnection();\n  }\n\n  /**\n   * Update the info.connection state depending on the error state of all\n   * sensors and the listening state of the remote sensor server.\n   */\n  private updateInfoConnection (): void {\n    // check if remote sensor server is listening if enabled\n    if (this.remoteSensorServer && !this.remoteSensorServer.isListening()) {\n      // server enabled but not listening\n      this.setStateAsync('info.connection', false, true);\n      return;\n    }\n\n    // check all sensors for errors\n    for (const id in this.sensors) {\n      if (this.sensors[id].hasError) {\n        // at least one sensor has an error, set connection state to false\n        this.setStateAsync('info.connection', false, true);\n        return;\n      }\n    }\n\n    // all sensors are ok, set connection state to true\n    this.setStateAsync('info.connection', true, true);\n  }\n\n  /**\n   * Get a defined sensor from it's ioBroker ID or 1-wire address.\n   * @param  idOrAddress The ID or address of the sensor.\n   * @return             The sensor or null.\n   */\n  public getSensor (idOrAddress: string): Sensor | null {\n    if (this.sensors[idOrAddress]) return this.sensors[idOrAddress];\n\n    // check address\n    for (const id in this.sensors) {\n      if (this.sensors[id].address === idOrAddress) {\n        return this.sensors[id];\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Trigger the reading of a single sensor or all sensors.\n   * @param idOrAddress The ioBroker ID or 1-wire address of the sensor. Use `all` or an empty string to read all sensors.\n   */\n  private readNow (idOrAddress?: string): void {\n    if (typeof idOrAddress !== 'string' || idOrAddress === 'all' || idOrAddress === '') {\n      // read all sensors\n      this.log.info(`Read data from all sensors now`);\n      for (const addr in this.sensors) {\n        this.sensors[addr].read();\n      }\n\n    } else {\n      // read a specific sensor\n      const sens = this.getSensor(idOrAddress);\n\n      if (!sens) {\n        this.log.warn(`No sensor with address or id ${idOrAddress} found!`);\n        return;\n      }\n\n      this.log.info(`Read data from sensor ${sens.address} now`);\n      sens.read();\n    }\n  }\n\n  /**\n   * Is called if a subscribed state changes.\n   * @param id    The ID of the state.\n   * @param state The ioBroker state.\n   */\n  @boundMethod\n  private async onStateChange(id: string, state: ioBroker.State | null | undefined): Promise<void> {\n    if (state) {\n      // The state was changed\n      this.log.debug(`state ${id} changed: ${state.val} (ack = ${state.ack}) ` + JSON.stringify(state));\n\n      // don't do anything if ack is set\n      if (state.ack === true) return;\n\n      // handle special states\n      switch (id) {\n        case this.namespace + '.actions.readNow':\n          this.readNow(state.val as string);\n          this.setStateAsync(this.namespace + '.actions.readNow', '', true);\n          break;\n      }\n\n    } else {\n      // The state was deleted\n      this.log.debug(`state ${id} deleted`);\n    }\n  }\n\n  /**\n   * Some message was sent to this instance over message box (e.g. by a script).\n   * @param obj The received ioBroker message.\n   */\n  @boundMethod\n  private async onMessage(obj: ioBroker.Message): Promise<void> {\n    this.log.debug('got message ' + JSON.stringify(obj));\n\n    if (typeof obj === 'object' && obj.message) {\n      switch (obj.command) {\n        case 'readNow':\n          // we should read sensors now...\n          if (typeof obj.message === 'string') {\n            this.readNow(obj.message);\n          } else {\n            this.readNow();\n          }\n          break;\n\n        case 'read':\n          // read a sensor\n          if (typeof obj.message === 'string') {\n            const sens = this.getSensor(obj.message);\n            if (!sens) {\n              this.log.debug('no such sensor');\n              return this.sendTo(obj.from, obj.command, { err: 'No such sensor' , value: null }, obj.callback);\n            }\n            sens.read((err, value) => {\n              if (err) {\n                this.log.debug(err.toString());\n                this.sendTo(obj.from, obj.command, { err: err.toString() , value: null }, obj.callback);\n              } else {\n                this.sendTo(obj.from, obj.command, { err: null , value: value }, obj.callback);\n              }\n            });\n          } else {\n            this.log.debug('no address or id given');\n            return this.sendTo(obj.from, obj.command, { err: 'No sensor address or id given' , value: null }, obj.callback);\n          }\n          break;\n\n        case 'getRemoteSystems':\n          // get connected remote systems\n          // don't do anything if no callback is provided\n          if (!obj.callback) return;\n\n          if (!this.remoteSensorServer) {\n            this.sendTo(obj.from, obj.command, [], obj.callback);\n            return;\n          }\n          const systems = this.remoteSensorServer.getConnectedSystems();\n          this.sendTo(obj.from, obj.command, systems, obj.callback);\n\n          break;\n\n        case 'search':\n          // search for sensors\n          // don't do anything if no callback is provided\n          if (!obj.callback) return;\n\n          const sensors: SearchedSensor[] = [];\n          let err: Error | null = null;\n\n          // local sensors\n          try {\n            const files = await readDir(this.config.w1DevicesPath);\n\n            const proms: Promise<string>[] = [];\n            for (const file of files) {\n              if (file.match(/^w1_bus_master\\d+$/)) { // devices path used\n                this.log.debug(`reading ${this.config.w1DevicesPath}/${file}/w1_master_slaves`);\n                proms.push(readFile(`${this.config.w1DevicesPath}/${file}/w1_master_slaves`, 'utf8'));\n              } else if (file === 'w1_master_slaves') { // path of one w1_bus_masterX used\n                this.log.debug(`reading ${this.config.w1DevicesPath}/w1_master_slaves`);\n                proms.push(readFile(`${this.config.w1DevicesPath}/w1_master_slaves`, 'utf8'));\n              }\n            }\n\n            const localSensors: SearchedSensor[] = (await Promise.all(proms)).reduce<string[]>((acc, cur) => {\n              acc.push(...cur.trim().split('\\n'));\n              return acc;\n            }, []).map((addr) => ({ address: addr, remoteSystemId: '' }));\n\n            sensors.push(...localSensors);\n\n          } catch (er: any) {\n            this.log.warn(`Error while searching for local sensors: ${er.toString()}`);\n            if (!this.config.remoteEnabled) {\n              err = er;\n            }\n          }\n\n          // remote sensors\n          if (this.config.remoteEnabled && this.remoteSensorServer) {\n            try {\n              const remoteSensors = await this.remoteSensorServer.search();\n              sensors.push(...remoteSensors);\n            } catch (er: any) {\n              this.log.warn(`Error while searching for remote sensors: ${er.toString()}`);\n            }\n          }\n\n          this.log.debug(`sensors found: ${JSON.stringify(sensors)}`);\n          this.sendTo(obj.from, obj.command, { err, sensors }, obj.callback);\n\n          break;\n      }\n    }\n  }\n\n}\n\nif (require.main !== module) {\n  // Export the constructor in compact mode\n  module.exports = (options: Partial<AdapterOptions> | undefined) => new Ds18b20Adapter(options);\n} else {\n  // otherwise start the instance directly\n  (() => new Ds18b20Adapter())();\n}\n\n// export the type of the adapter class to use it in other files\nexport type { Ds18b20Adapter };\n"],
  "mappings": "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",
  "names": ["err"]
}
