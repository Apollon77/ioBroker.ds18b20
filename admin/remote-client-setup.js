"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const os = require("os");
const path = require("path");
const SYSTEMD_SERVICE_NAME = 'iobroker-ds18b20-remote.service';
const files = {
    'common.js': 'InVzZSBzdHJpY3QiOwpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwpleHBvcnRzLmRlY3J5cHQgPSBleHBvcnRzLmVuY3J5cHQgPSBleHBvcnRzLlJFTU9URV9QUk9UT0NPTF9WRVJTSU9OID0gdm9pZCAwOwpjb25zdCBjcnlwdG8gPSByZXF1aXJlKCJjcnlwdG8iKTsKZXhwb3J0cy5SRU1PVEVfUFJPVE9DT0xfVkVSU0lPTiA9IDI7CmNvbnN0IElWX0xFTkdUSCA9IDE2OwpmdW5jdGlvbiBlbmNyeXB0KHRleHQsIGtleSkgewogICAgY29uc3QgaXYgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoSVZfTEVOR1RIKTsKICAgIGNvbnN0IGNpcGhlciA9IGNyeXB0by5jcmVhdGVDaXBoZXJpdignYWVzLTI1Ni1jYmMnLCBrZXksIGl2KTsKICAgIGxldCBlbmNyeXB0ZWQgPSBjaXBoZXIudXBkYXRlKHRleHQpOwogICAgZW5jcnlwdGVkID0gQnVmZmVyLmNvbmNhdChbZW5jcnlwdGVkLCBjaXBoZXIuZmluYWwoKV0pOwogICAgcmV0dXJuIGl2LnRvU3RyaW5nKCdoZXgnKSArICc6JyArIGVuY3J5cHRlZC50b1N0cmluZygnaGV4Jyk7Cn0KZXhwb3J0cy5lbmNyeXB0ID0gZW5jcnlwdDsKZnVuY3Rpb24gZGVjcnlwdCh0ZXh0LCBrZXkpIHsKICAgIGNvbnN0IHRleHRQYXJ0cyA9IHRleHQuc3BsaXQoJzonKTsKICAgIGNvbnN0IGl2ID0gQnVmZmVyLmZyb20odGV4dFBhcnRzLnNoaWZ0KCksICdoZXgnKTsKICAgIGNvbnN0IGVuY3J5cHRlZFRleHQgPSBCdWZmZXIuZnJvbSh0ZXh0UGFydHMuam9pbignOicpLCAnaGV4Jyk7CiAgICBjb25zdCBkZWNpcGhlciA9IGNyeXB0by5jcmVhdGVEZWNpcGhlcml2KCdhZXMtMjU2LWNiYycsIGtleSwgaXYpOwogICAgbGV0IGRlY3J5cHRlZCA9IGRlY2lwaGVyLnVwZGF0ZShlbmNyeXB0ZWRUZXh0KTsKICAgIGRlY3J5cHRlZCA9IEJ1ZmZlci5jb25jYXQoW2RlY3J5cHRlZCwgZGVjaXBoZXIuZmluYWwoKV0pOwogICAgcmV0dXJuIGRlY3J5cHRlZC50b1N0cmluZygpOwp9CmV4cG9ydHMuZGVjcnlwdCA9IGRlY3J5cHQ7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbW1vbi5qcy5tYXA=',
'ds18b20-remote-client.js': 'InVzZSBzdHJpY3QiOwp2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHsKICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfQogICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfQogICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yWyJ0aHJvdyJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQogICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTsKICAgIH0pOwp9OwpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwpjb25zdCB1dGlsXzEgPSByZXF1aXJlKCJ1dGlsIik7CmNvbnN0IG5ldF8xID0gcmVxdWlyZSgibmV0Iik7CmNvbnN0IGZzID0gcmVxdWlyZSgiZnMiKTsKY29uc3Qgb3MgPSByZXF1aXJlKCJvcyIpOwpjb25zdCByZWFkRGlyID0gKDAsIHV0aWxfMS5wcm9taXNpZnkpKGZzLnJlYWRkaXIpOwpjb25zdCByZWFkRmlsZSA9ICgwLCB1dGlsXzEucHJvbWlzaWZ5KShmcy5yZWFkRmlsZSk7CmNvbnN0IGxvZ2dlcl8xID0gcmVxdWlyZSgiLi9sb2dnZXIiKTsKY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKCIuL2NvbW1vbiIpOwpjb25zdCBFTlZfS0VZUyA9IFsKICAgICdBREFQVEVSX0hPU1QnLAogICAgJ0FEQVBURVJfS0VZJywKICAgICdBREFQVEVSX1BPUlQnLAogICAgJ0RFQlVHJywKICAgICdTWVNURU1fSUQnLAogICAgJ1cxX0RFVklDRVNfUEFUSCcsCl07CmNsYXNzIERzMThiMjBSZW1vdGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgdGhpcy5yZWNvbm5lY3RUaW1lb3V0ID0gbnVsbDsKICAgICAgICB0aGlzLnNob3VsZEV4aXQgPSBmYWxzZTsKICAgICAgICB0aGlzLnJlY3ZEYXRhID0gJyc7CiAgICAgICAgdGhpcy5jb25uZWN0ID0gdGhpcy5jb25uZWN0LmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5leGl0ID0gdGhpcy5leGl0LmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5vbkNsb3NlID0gdGhpcy5vbkNsb3NlLmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5vbkRhdGEgPSB0aGlzLm9uRGF0YS5iaW5kKHRoaXMpOwogICAgICAgIHRoaXMub25FcnJvciA9IHRoaXMub25FcnJvci5iaW5kKHRoaXMpOwogICAgICAgIHRoaXMub25Db25uZWN0ID0gdGhpcy5vbkNvbm5lY3QuYmluZCh0aGlzKTsKICAgICAgICB0aGlzLmxvZyA9IG5ldyBsb2dnZXJfMS5Mb2dnZXIoKTsKICAgICAgICB0aGlzLmxvZy5sb2coJy0gaW9Ccm9rZXIuZHMxOGIyMCByZW1vdGUgY2xpZW50IC0nKTsKICAgICAgICB0aGlzLnJlYWREb3RFbnYoKTsKICAgICAgICBpZiAocHJvY2Vzcy5lbnYuU1lTVEVNX0lEKSB7CiAgICAgICAgICAgIHRoaXMuc3lzdGVtSWQgPSBwcm9jZXNzLmVudi5TWVNURU1fSUQudHJpbSgpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdGhpcy5zeXN0ZW1JZCA9IG9zLmhvc3RuYW1lKCk7CiAgICAgICAgICAgIHRoaXMubG9nLndhcm4oYFVzaW5nIHRoZSBob3N0bmFtZSAke3RoaXMuc3lzdGVtSWR9IGFzIHN5c3RlbSBJRC4gUGxlYXNlIHNldCBTWVNURU1fSUQgdG8gYSB1bmlxdWUgdmFsdWUuYCk7CiAgICAgICAgfQogICAgICAgIHRoaXMubG9nLmRlYnVnKGBzeXN0ZW1JZGAsIHRoaXMuc3lzdGVtSWQpOwogICAgICAgIGlmIChwcm9jZXNzLmVudi5BREFQVEVSX1BPUlQpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHRoaXMuYWRhcHRlclBvcnQgPSBwYXJzZUludChwcm9jZXNzLmVudi5BREFQVEVSX1BPUlQsIDEwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvZy5lcnJvcihgSW52YWxpZCBBREFQVEVSX1BPUlQhYCwgZXJyKTsKICAgICAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdGhpcy5hZGFwdGVyUG9ydCA9IDE4MjA7CiAgICAgICAgfQogICAgICAgIHRoaXMubG9nLmRlYnVnKGBhZGFwdGVyUG9ydGAsIHRoaXMuYWRhcHRlclBvcnQpOwogICAgICAgIHRoaXMuYWRhcHRlckhvc3QgPSAocHJvY2Vzcy5lbnYuQURBUFRFUl9IT1NUIHx8ICcnKS50cmltKCk7CiAgICAgICAgaWYgKHRoaXMuYWRhcHRlckhvc3QubGVuZ3RoIDw9IDApIHsKICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoYE5vIEFEQVBURVJfSE9TVCBnaXZlbiFgKTsKICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhgYWRhcHRlckhvc3RgLCB0aGlzLmFkYXB0ZXJIb3N0KTsKICAgICAgICB0aGlzLmFkYXB0ZXJLZXkgPSBCdWZmZXIuZnJvbShwcm9jZXNzLmVudi5BREFQVEVSX0tFWSB8fCAnJywgJ2hleCcpOwogICAgICAgIGlmICh0aGlzLmFkYXB0ZXJLZXkubGVuZ3RoICE9PSAzMikgewogICAgICAgICAgICB0aGlzLmxvZy5lcnJvcihgQURBUFRFUl9LRVkgaXMgbm8gdmFsaWQga2V5IWApOwogICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubG9nLmRlYnVnKGBhZGFwdGVyS2V5YCwgdGhpcy5hZGFwdGVyS2V5KTsKICAgICAgICB0aGlzLncxRGV2aWNlc1BhdGggPSBwcm9jZXNzLmVudi5XMV9ERVZJQ0VTX1BBVEggfHwgJy9zeXMvYnVzL3cxL2RldmljZXMnOwogICAgICAgIGlmICghZnMuZXhpc3RzU3luYyh0aGlzLncxRGV2aWNlc1BhdGgpKSB7CiAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKGBUaGUgMS13aXJlIGRldmljZXMgcGF0aCAke3RoaXMudzFEZXZpY2VzUGF0aH0gZG9lcyBub3QgZXhpc3QhYCk7CiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5sb2cuZGVidWcoYHcxRGV2aWNlc1BhdGhgLCB0aGlzLncxRGV2aWNlc1BhdGgpOwogICAgICAgIHByb2Nlc3Mub24oJ1NJR0lOVCcsIHRoaXMuZXhpdCk7CiAgICAgICAgcHJvY2Vzcy5vbignU0lHVEVSTScsIHRoaXMuZXhpdCk7CiAgICAgICAgdGhpcy5zb2NrZXQgPSBuZXcgbmV0XzEuU29ja2V0KCk7CiAgICAgICAgdGhpcy5zb2NrZXQub24oJ2Nsb3NlJywgdGhpcy5vbkNsb3NlKTsKICAgICAgICB0aGlzLnNvY2tldC5vbignZGF0YScsIHRoaXMub25EYXRhKTsKICAgICAgICB0aGlzLnNvY2tldC5vbignZXJyb3InLCB0aGlzLm9uRXJyb3IpOwogICAgICAgIHRoaXMuc29ja2V0Lm9uKCdjb25uZWN0JywgdGhpcy5vbkNvbm5lY3QpOwogICAgICAgIHRoaXMuY29ubmVjdCgpOwogICAgfQogICAgY29ubmVjdCgpIHsKICAgICAgICBpZiAodGhpcy5yZWNvbm5lY3RUaW1lb3V0KSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJlY29ubmVjdFRpbWVvdXQpOwogICAgICAgICAgICB0aGlzLnJlY29ubmVjdFRpbWVvdXQgPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5zaG91bGRFeGl0KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5sb2cuaW5mbyhgQ29ubmVjdGluZyB0byAke3RoaXMuYWRhcHRlckhvc3R9OiR7dGhpcy5hZGFwdGVyUG9ydH0gLi4uYCk7CiAgICAgICAgdGhpcy5zb2NrZXQuY29ubmVjdCh7CiAgICAgICAgICAgIGhvc3Q6IHRoaXMuYWRhcHRlckhvc3QsCiAgICAgICAgICAgIHBvcnQ6IHRoaXMuYWRhcHRlclBvcnQsCiAgICAgICAgfSk7CiAgICB9CiAgICBvbkNvbm5lY3QoKSB7CiAgICAgICAgdGhpcy5sb2cuaW5mbyhgQ29ubmVjdGVkIHdpdGggYWRhcHRlcmApOwogICAgICAgIGlmICh0aGlzLnJlY29ubmVjdFRpbWVvdXQpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVjb25uZWN0VGltZW91dCk7CiAgICAgICAgfQogICAgICAgIHRoaXMucmVjb25uZWN0VGltZW91dCA9IG51bGw7CiAgICB9CiAgICBvbkRhdGEoZGF0YSkgewogICAgICAgIHRoaXMucmVjdkRhdGEgKz0gZGF0YS50b1N0cmluZygpOwogICAgICAgIGxldCBpZHggPSB0aGlzLnJlY3ZEYXRhLmluZGV4T2YoJ1xuJyk7CiAgICAgICAgd2hpbGUgKGlkeCA+IDApIHsKICAgICAgICAgICAgY29uc3QgcmF3ID0gdGhpcy5yZWN2RGF0YS5zbGljZSgwLCBpZHgpOwogICAgICAgICAgICB0aGlzLnJlY3ZEYXRhID0gdGhpcy5yZWN2RGF0YS5zbGljZShpZHggKyAxKTsKICAgICAgICAgICAgdGhpcy5oYW5kbGVTb2NrZXREYXRhKHJhdyk7CiAgICAgICAgICAgIGlkeCA9IHRoaXMucmVjdkRhdGEuaW5kZXhPZignXG4nKTsKICAgICAgICB9CiAgICB9CiAgICBoYW5kbGVTb2NrZXREYXRhKHJhdykgewogICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7CiAgICAgICAgICAgIGxldCBkYXRhOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgZGF0YVN0ciA9ICgwLCBjb21tb25fMS5kZWNyeXB0KShyYXcsIHRoaXMuYWRhcHRlcktleSk7CiAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhU3RyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvZy53YXJuKGBEZWNyeXB0IG9mIGRhdGEgZmFpbGVkISAke2Vyci50b1N0cmluZygpfWApOwogICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuZW5kKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5sb2cuZGVidWcoJ21lc3NhZ2UgZnJvbSBhZGFwdGVyOicsIGRhdGEpOwogICAgICAgICAgICBzd2l0Y2ggKGRhdGEuY21kKSB7CiAgICAgICAgICAgICAgICBjYXNlICdjbGllbnRJbmZvJzoKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5wcm90b2NvbFZlcnNpb24gIT09IGNvbW1vbl8xLlJFTU9URV9QUk9UT0NPTF9WRVJTSU9OKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLndhcm4oYFByb3RvY29sIHZlcnNpb24gJHtkYXRhLnByb3RvY29sVmVyc2lvbn0gZnJvbSB0aGUgYWRhcHRlciBkb2VzIG5vdCBtYXRjaCB0aGUgcmVtb3RlIGNsaWVudCBwcm90b2NvbCB2ZXJzaW9uICR7Y29tbW9uXzEuUkVNT1RFX1BST1RPQ09MX1ZFUlNJT059ISBQbGVhc2UgcmVpbnN0YWxsIHRoZSByZW1vdGUgY2xpZW50LmApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZy5pbmZvKCdTZW5kaW5nIGNsaWVudCBpbmZvIHRvIHRoZSBhZGFwdGVyJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgY21kOiAnY2xpZW50SW5mbycsCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3RvY29sVmVyc2lvbjogY29tbW9uXzEuUkVNT1RFX1BST1RPQ09MX1ZFUlNJT04sCiAgICAgICAgICAgICAgICAgICAgICAgIHN5c3RlbUlkOiB0aGlzLnN5c3RlbUlkLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAncmVhZCc6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhLmFkZHJlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cud2FybihgR290IHJlYWQgY29tbWFuZCB3aXRob3V0IGFkZHJlc3MgZnJvbSBhZGFwdGVyIWApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxldCByYXc7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmF3ID0geWllbGQgcmVhZEZpbGUoYCR7dGhpcy53MURldmljZXNQYXRofS8ke2RhdGEuYWRkcmVzc30vdzFfc2xhdmVgLCAndXRmOCcpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhgUmVhZCBmcm9tIGZpbGUgJHt0aGlzLncxRGV2aWNlc1BhdGh9LyR7ZGF0YS5hZGRyZXNzfS93MV9zbGF2ZTpgLCByYXcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLndhcm4oYFJlYWQgZnJvbSBmaWxlICR7dGhpcy53MURldmljZXNQYXRofS8ke2RhdGEuYWRkcmVzc30vdzFfc2xhdmUgZmFpbGVkISAke2Vyci50b1N0cmluZygpfWApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhlcnIpOwogICAgICAgICAgICAgICAgICAgICAgICByYXcgPSAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgeWllbGQgdGhpcy5zZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgY21kOiAncmVhZCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IGRhdGEuYWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgICAgdHM6IGRhdGEudHMsCiAgICAgICAgICAgICAgICAgICAgICAgIHJhdywKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3NlYXJjaCc6CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZXMgPSB5aWVsZCByZWFkRGlyKHRoaXMudzFEZXZpY2VzUGF0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb21zID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZmlsZXNbaV0ubWF0Y2goL153MV9idXNfbWFzdGVyXGQrJC8pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhgcmVhZGluZyAke3RoaXMudzFEZXZpY2VzUGF0aH0vJHtmaWxlc1tpXX0vdzFfbWFzdGVyX3NsYXZlc2ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbXMucHVzaChyZWFkRmlsZShgJHt0aGlzLncxRGV2aWNlc1BhdGh9LyR7ZmlsZXNbaV19L3cxX21hc3Rlcl9zbGF2ZXNgLCAndXRmOCcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhZGRyZXNzZXMgPSAoeWllbGQgUHJvbWlzZS5hbGwocHJvbXMpKS5yZWR1Y2UoKGFjYywgY3VyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2MucHVzaCguLi5jdXIudHJpbSgpLnNwbGl0KCdcbicpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY2M7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIFtdKTsKICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQgdGhpcy5zZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtZDogJ3NlYXJjaCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0czogZGF0YS50cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5c3RlbUlkOiBkYXRhLnN5c3RlbUlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzc2VzCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLndhcm4oYFNlYXJjaGluZyBmb3Igc2Vuc29ycyBmYWlsZWQhICR7ZXJyLnRvU3RyaW5nKCl9YCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKGVycik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZy53YXJuKGBVbmtub3duIGNvbW1hbmQgZnJvbSBhZGFwdGVyYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIG9uRXJyb3IoZXJyKSB7CiAgICAgICAgdGhpcy5sb2cud2FybihgU29ja2V0IGVycm9yOmAsIGVyci50b1N0cmluZygpKTsKICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhlcnIpOwogICAgICAgIHRoaXMuc29ja2V0LmVuZCgpOwogICAgICAgIHRoaXMucmVjb25uZWN0KCk7CiAgICB9CiAgICBvbkNsb3NlKCkgewogICAgICAgIHRoaXMubG9nLmluZm8oJ1NvY2tldCBjbG9zZWQnKTsKICAgICAgICB0aGlzLnJlY29ubmVjdCgpOwogICAgfQogICAgcmVjb25uZWN0KCkgewogICAgICAgIGlmICghdGhpcy5yZWNvbm5lY3RUaW1lb3V0ICYmICF0aGlzLnNob3VsZEV4aXQpIHsKICAgICAgICAgICAgdGhpcy5sb2cuaW5mbyhgUmVjb25uZWN0IGluIDMwIHNlY29uZHNgKTsKICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3RUaW1lb3V0ID0gc2V0VGltZW91dCh0aGlzLmNvbm5lY3QsIDMwMDAwKTsKICAgICAgICB9CiAgICB9CiAgICBzZW5kKGRhdGEpIHsKICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgICAgICAgICB0aGlzLmxvZy5kZWJ1Zygnc2VuZCB0byBhZGFwdGVyOicsIGRhdGEpOwogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQud3JpdGUoKDAsIGNvbW1vbl8xLmVuY3J5cHQpKEpTT04uc3RyaW5naWZ5KGRhdGEpLCB0aGlzLmFkYXB0ZXJLZXkpICsgJ1xuJywgKGVycikgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQogICAgcmVhZERvdEVudigpIHsKICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoJy5lbnYnKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGxldCBkYXRhOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoJy5lbnYnLCAndXRmLTgnKS5zcGxpdCgnXG4nKS5tYXAoKGwpID0+IGwudHJpbSgpKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGVycikgewogICAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnY2FuXCd0IHJlYWQgLmVudiBmaWxlJywgZXJyKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgZGF0YSkgewogICAgICAgICAgICBpZiAoIWxpbmUgfHwgbGluZS5zdGFydHNXaXRoKCcjJykpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY29uc3QgaWR4ID0gbGluZS5pbmRleE9mKCc9Jyk7CiAgICAgICAgICAgIGlmIChpZHggPD0gMCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjb25zdCBrZXkgPSBsaW5lLnNsaWNlKDAsIGlkeCkudHJpbSgpOwogICAgICAgICAgICBjb25zdCB2YWwgPSBsaW5lLnNsaWNlKGlkeCArIDEpLnRyaW0oKS5yZXBsYWNlKC8oXiJ8IiQpL2csICcnKTsKICAgICAgICAgICAgaWYgKEVOVl9LRVlTLmluZGV4T2Yoa2V5KSA+PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnZba2V5XSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIHByb2Nlc3MuZW52W2tleV0gPSB2YWw7CiAgICAgICAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhgcmVhZCAke2tleX09JHt2YWx9IGZyb20gLmVudiBmaWxlYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBleGl0KCkgewogICAgICAgIHRoaXMuc2hvdWxkRXhpdCA9IHRydWU7CiAgICAgICAgaWYgKHRoaXMucmVjb25uZWN0VGltZW91dCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5yZWNvbm5lY3RUaW1lb3V0KTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zb2NrZXQuZW5kKCk7CiAgICB9Cn0KbmV3IERzMThiMjBSZW1vdGUoKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZHMxOGIyMC1yZW1vdGUtY2xpZW50LmpzLm1hcA==',
'logger.js': 'InVzZSBzdHJpY3QiOwpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwpleHBvcnRzLkxvZ2dlciA9IHZvaWQgMDsKY2xhc3MgTG9nZ2VyIHsKICAgIGxvZyguLi5hcmdzKSB7CiAgICAgICAgY29uc29sZS5sb2coLi4uYXJncyk7CiAgICB9CiAgICBkZWJ1ZyguLi5hcmdzKSB7CiAgICAgICAgaWYgKCFwcm9jZXNzLmVudi5ERUJVRykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKCdbRGVidWddJywgLi4uYXJncyk7CiAgICB9CiAgICBpbmZvKC4uLmFyZ3MpIHsKICAgICAgICBjb25zb2xlLmxvZygnW0luZm9dJywgLi4uYXJncyk7CiAgICB9CiAgICB3YXJuKC4uLmFyZ3MpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1tXYXJuXScsIC4uLmFyZ3MpOwogICAgfQogICAgZXJyb3IoLi4uYXJncykgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tFcnJvcl0nLCAuLi5hcmdzKTsKICAgIH0KfQpleHBvcnRzLkxvZ2dlciA9IExvZ2dlcjsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9bG9nZ2VyLmpzLm1hcA=='
};
for (const f in files) {
    const content = Buffer.from(files[f], 'base64').toString('utf-8');
    fs.writeFileSync(f, content, { encoding: 'utf-8' });
}
const systemDContent = `[Unit]
Description=ioBroker.ds18b20 remote client
Documentation=https://github.com/crycode-de/ioBroker.ds18b20
After=network.target

[Service]
Type=simple
User=${os.userInfo().username}
WorkingDirectory=${__dirname}
ExecStart=${process.execPath} ${path.join(__dirname, 'ds18b20-remote-client.js')}
Restart=on-failure

[Install]
WantedBy=multi-user.target
`;
const systemDFile = path.join(__dirname, SYSTEMD_SERVICE_NAME);
fs.writeFileSync(systemDFile, systemDContent, { encoding: 'utf-8' });
const dotEnvContent = `# Settings for the ioBroker.ds18b20 remote client

# Unique ID for this remote system
SYSTEM_ID=my-remote

# IP or hostname of the ioBroker host running the adapter
ADAPTER_HOST=

# Port from the adapter config
ADAPTER_PORT=1820

# Encryption key from the adapter config
ADAPTER_KEY=

# Enable debug log output
#DEBUG=1

# System path of the 1-wire devices
#W1_DEVICES_PATH=/sys/bus/w1/devices
`;
const dotEnvFile = path.join(__dirname, '.env');
if (!fs.existsSync(dotEnvFile)) {
    fs.writeFileSync(dotEnvFile, dotEnvContent, { encoding: 'utf-8' });
}
console.log(`- ioBroker.ds18b20 remote client -

Basic setup done.

Please adjust the settings in the .env file.

To manually start the client just run:
  node ds18b20-remote-client.js

To setup the SystemD service, please run:
  sudo cp ${SYSTEMD_SERVICE_NAME} /etc/systemd/system/${SYSTEMD_SERVICE_NAME}
  sudo systemctl daemon-reload
  sudo systemctl enable ${SYSTEMD_SERVICE_NAME}
  sudo systemctl start ${SYSTEMD_SERVICE_NAME}
`);
//# sourceMappingURL=setup.js.map