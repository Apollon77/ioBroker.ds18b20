"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const os = require("os");
const path = require("path");
const SYSTEMD_SERVICE_NAME = 'iobroker-ds18b20-remote.service';
const files = {
    'common.js': 'InVzZSBzdHJpY3QiOwpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwpleHBvcnRzLmRlY3J5cHQgPSBleHBvcnRzLmVuY3J5cHQgPSBleHBvcnRzLlJFTU9URV9QUk9UT0NPTF9WRVJTSU9OID0gdm9pZCAwOwpjb25zdCBjcnlwdG8gPSByZXF1aXJlKCJjcnlwdG8iKTsKZXhwb3J0cy5SRU1PVEVfUFJPVE9DT0xfVkVSU0lPTiA9IDE7CmNvbnN0IElWX0xFTkdUSCA9IDE2OwpmdW5jdGlvbiBlbmNyeXB0KHRleHQsIGtleSkgewogICAgY29uc3QgaXYgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoSVZfTEVOR1RIKTsKICAgIGNvbnN0IGNpcGhlciA9IGNyeXB0by5jcmVhdGVDaXBoZXJpdignYWVzLTI1Ni1jYmMnLCBrZXksIGl2KTsKICAgIGxldCBlbmNyeXB0ZWQgPSBjaXBoZXIudXBkYXRlKHRleHQpOwogICAgZW5jcnlwdGVkID0gQnVmZmVyLmNvbmNhdChbZW5jcnlwdGVkLCBjaXBoZXIuZmluYWwoKV0pOwogICAgcmV0dXJuIGl2LnRvU3RyaW5nKCdoZXgnKSArICc6JyArIGVuY3J5cHRlZC50b1N0cmluZygnaGV4Jyk7Cn0KZXhwb3J0cy5lbmNyeXB0ID0gZW5jcnlwdDsKZnVuY3Rpb24gZGVjcnlwdCh0ZXh0LCBrZXkpIHsKICAgIGNvbnN0IHRleHRQYXJ0cyA9IHRleHQuc3BsaXQoJzonKTsKICAgIGNvbnN0IGl2ID0gQnVmZmVyLmZyb20odGV4dFBhcnRzLnNoaWZ0KCksICdoZXgnKTsKICAgIGNvbnN0IGVuY3J5cHRlZFRleHQgPSBCdWZmZXIuZnJvbSh0ZXh0UGFydHMuam9pbignOicpLCAnaGV4Jyk7CiAgICBjb25zdCBkZWNpcGhlciA9IGNyeXB0by5jcmVhdGVEZWNpcGhlcml2KCdhZXMtMjU2LWNiYycsIGtleSwgaXYpOwogICAgbGV0IGRlY3J5cHRlZCA9IGRlY2lwaGVyLnVwZGF0ZShlbmNyeXB0ZWRUZXh0KTsKICAgIGRlY3J5cHRlZCA9IEJ1ZmZlci5jb25jYXQoW2RlY3J5cHRlZCwgZGVjaXBoZXIuZmluYWwoKV0pOwogICAgcmV0dXJuIGRlY3J5cHRlZC50b1N0cmluZygpOwp9CmV4cG9ydHMuZGVjcnlwdCA9IGRlY3J5cHQ7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbW1vbi5qcy5tYXA=',
'ds18b20-remote-client.js': 'InVzZSBzdHJpY3QiOwp2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHsKICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfQogICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfQogICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yWyJ0aHJvdyJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQogICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTsKICAgIH0pOwp9OwpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwpjb25zdCB1dGlsXzEgPSByZXF1aXJlKCJ1dGlsIik7CmNvbnN0IG5ldF8xID0gcmVxdWlyZSgibmV0Iik7CmNvbnN0IGZzID0gcmVxdWlyZSgiZnMiKTsKY29uc3Qgb3MgPSByZXF1aXJlKCJvcyIpOwpjb25zdCByZWFkRGlyID0gKDAsIHV0aWxfMS5wcm9taXNpZnkpKGZzLnJlYWRkaXIpOwpjb25zdCByZWFkRmlsZSA9ICgwLCB1dGlsXzEucHJvbWlzaWZ5KShmcy5yZWFkRmlsZSk7CmNvbnN0IGxvZ2dlcl8xID0gcmVxdWlyZSgiLi9sb2dnZXIiKTsKY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKCIuL2NvbW1vbiIpOwpjb25zdCBFTlZfS0VZUyA9IFsKICAgICdBREFQVEVSX0hPU1QnLAogICAgJ0FEQVBURVJfS0VZJywKICAgICdBREFQVEVSX1BPUlQnLAogICAgJ0RFQlVHJywKICAgICdTWVNURU1fSUQnLAogICAgJ1cxX0RFVklDRVNfUEFUSCcsCl07CmNsYXNzIERzMThiMjBSZW1vdGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgdGhpcy5yZWNvbm5lY3RUaW1lb3V0ID0gbnVsbDsKICAgICAgICB0aGlzLnNob3VsZEV4aXQgPSBmYWxzZTsKICAgICAgICB0aGlzLnJlY3ZEYXRhID0gJyc7CiAgICAgICAgdGhpcy5jb25uZWN0ID0gdGhpcy5jb25uZWN0LmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5leGl0ID0gdGhpcy5leGl0LmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5vbkNsb3NlID0gdGhpcy5vbkNsb3NlLmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5vbkRhdGEgPSB0aGlzLm9uRGF0YS5iaW5kKHRoaXMpOwogICAgICAgIHRoaXMub25FcnJvciA9IHRoaXMub25FcnJvci5iaW5kKHRoaXMpOwogICAgICAgIHRoaXMubG9nID0gbmV3IGxvZ2dlcl8xLkxvZ2dlcigpOwogICAgICAgIHRoaXMubG9nLmxvZygnLSBpb0Jyb2tlci5kczE4YjIwIHJlbW90ZSBjbGllbnQgLScpOwogICAgICAgIHRoaXMucmVhZERvdEVudigpOwogICAgICAgIGlmIChwcm9jZXNzLmVudi5TWVNURU1fSUQpIHsKICAgICAgICAgICAgdGhpcy5zeXN0ZW1JZCA9IHByb2Nlc3MuZW52LlNZU1RFTV9JRC50cmltKCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0aGlzLnN5c3RlbUlkID0gb3MuaG9zdG5hbWUoKTsKICAgICAgICAgICAgdGhpcy5sb2cud2FybihgVXNpbmcgdGhlIGhvc3RuYW1lICR7dGhpcy5zeXN0ZW1JZH0gYXMgc3lzdGVtIElELiBQbGVhc2Ugc2V0IFNZU1RFTV9JRCB0byBhIHVuaXF1ZSB2YWx1ZS5gKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5sb2cuZGVidWcoYHN5c3RlbUlkYCwgdGhpcy5zeXN0ZW1JZCk7CiAgICAgICAgaWYgKHByb2Nlc3MuZW52LkFEQVBURVJfUE9SVCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdGhpcy5hZGFwdGVyUG9ydCA9IHBhcnNlSW50KHByb2Nlc3MuZW52LkFEQVBURVJfUE9SVCwgMTApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKGBJbnZhbGlkIEFEQVBURVJfUE9SVCFgLCBlcnIpOwogICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0aGlzLmFkYXB0ZXJQb3J0ID0gMTgyMDsKICAgICAgICB9CiAgICAgICAgdGhpcy5sb2cuZGVidWcoYGFkYXB0ZXJQb3J0YCwgdGhpcy5hZGFwdGVyUG9ydCk7CiAgICAgICAgdGhpcy5hZGFwdGVySG9zdCA9IChwcm9jZXNzLmVudi5BREFQVEVSX0hPU1QgfHwgJycpLnRyaW0oKTsKICAgICAgICBpZiAodGhpcy5hZGFwdGVySG9zdC5sZW5ndGggPD0gMCkgewogICAgICAgICAgICB0aGlzLmxvZy5lcnJvcihgTm8gQURBUFRFUl9IT1NUIGdpdmVuIWApOwogICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubG9nLmRlYnVnKGBhZGFwdGVySG9zdGAsIHRoaXMuYWRhcHRlckhvc3QpOwogICAgICAgIHRoaXMuYWRhcHRlcktleSA9IEJ1ZmZlci5mcm9tKHByb2Nlc3MuZW52LkFEQVBURVJfS0VZIHx8ICcnLCAnaGV4Jyk7CiAgICAgICAgaWYgKHRoaXMuYWRhcHRlcktleS5sZW5ndGggIT09IDMyKSB7CiAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKGBBREFQVEVSX0tFWSBpcyBubyB2YWxpZCBrZXkhYCk7CiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5sb2cuZGVidWcoYGFkYXB0ZXJLZXlgLCB0aGlzLmFkYXB0ZXJLZXkpOwogICAgICAgIHRoaXMudzFEZXZpY2VzUGF0aCA9IHByb2Nlc3MuZW52LlcxX0RFVklDRVNfUEFUSCB8fCAnL3N5cy9idXMvdzEvZGV2aWNlcyc7CiAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKHRoaXMudzFEZXZpY2VzUGF0aCkpIHsKICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoYFRoZSAxLXdpcmUgZGV2aWNlcyBwYXRoICR7dGhpcy53MURldmljZXNQYXRofSBkb2VzIG5vdCBleGlzdCFgKTsKICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhgdzFEZXZpY2VzUGF0aGAsIHRoaXMudzFEZXZpY2VzUGF0aCk7CiAgICAgICAgcHJvY2Vzcy5vbignU0lHSU5UJywgdGhpcy5leGl0KTsKICAgICAgICBwcm9jZXNzLm9uKCdTSUdURVJNJywgdGhpcy5leGl0KTsKICAgICAgICB0aGlzLnNvY2tldCA9IG5ldyBuZXRfMS5Tb2NrZXQoKTsKICAgICAgICB0aGlzLnNvY2tldC5vbignY2xvc2UnLCB0aGlzLm9uQ2xvc2UpOwogICAgICAgIHRoaXMuc29ja2V0Lm9uKCdkYXRhJywgdGhpcy5vbkRhdGEpOwogICAgICAgIHRoaXMuc29ja2V0Lm9uKCdlcnJvcicsIHRoaXMub25FcnJvcik7CiAgICAgICAgdGhpcy5jb25uZWN0KCk7CiAgICB9CiAgICBjb25uZWN0KCkgewogICAgICAgIGlmICh0aGlzLnJlY29ubmVjdFRpbWVvdXQpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVjb25uZWN0VGltZW91dCk7CiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0VGltZW91dCA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnNob3VsZEV4aXQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmxvZy5pbmZvKGBDb25uZWN0aW5nIHRvICR7dGhpcy5hZGFwdGVySG9zdH06JHt0aGlzLmFkYXB0ZXJQb3J0fSAuLi5gKTsKICAgICAgICB0aGlzLnNvY2tldC5jb25uZWN0KHsKICAgICAgICAgICAgaG9zdDogdGhpcy5hZGFwdGVySG9zdCwKICAgICAgICAgICAgcG9ydDogdGhpcy5hZGFwdGVyUG9ydCwKICAgICAgICB9LCAoKSA9PiB7CiAgICAgICAgICAgIHRoaXMubG9nLmluZm8oYENvbm5lY3RlZCB3aXRoIGFkYXB0ZXJgKTsKICAgICAgICAgICAgaWYgKHRoaXMucmVjb25uZWN0VGltZW91dCkgewogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVjb25uZWN0VGltZW91dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3RUaW1lb3V0ID0gbnVsbDsKICAgICAgICB9KTsKICAgIH0KICAgIG9uRGF0YShkYXRhKSB7CiAgICAgICAgdGhpcy5yZWN2RGF0YSArPSBkYXRhLnRvU3RyaW5nKCk7CiAgICAgICAgbGV0IGlkeCA9IHRoaXMucmVjdkRhdGEuaW5kZXhPZignXG4nKTsKICAgICAgICB3aGlsZSAoaWR4ID4gMCkgewogICAgICAgICAgICBjb25zdCByYXcgPSB0aGlzLnJlY3ZEYXRhLnNsaWNlKDAsIGlkeCk7CiAgICAgICAgICAgIHRoaXMucmVjdkRhdGEgPSB0aGlzLnJlY3ZEYXRhLnNsaWNlKGlkeCArIDEpOwogICAgICAgICAgICB0aGlzLmhhbmRsZVNvY2tldERhdGEocmF3KTsKICAgICAgICAgICAgaWR4ID0gdGhpcy5yZWN2RGF0YS5pbmRleE9mKCdcbicpOwogICAgICAgIH0KICAgIH0KICAgIGhhbmRsZVNvY2tldERhdGEocmF3KSB7CiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsKICAgICAgICAgICAgbGV0IGRhdGE7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhU3RyID0gKDAsIGNvbW1vbl8xLmRlY3J5cHQpKHJhdywgdGhpcy5hZGFwdGVyS2V5KTsKICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGFTdHIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9nLndhcm4oYERlY3J5cHQgb2YgZGF0YSBmYWlsZWQhICR7ZXJyLnRvU3RyaW5nKCl9YCk7CiAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC5lbmQoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnbWVzc2FnZSBmcm9tIGFkYXB0ZXI6JywgZGF0YSk7CiAgICAgICAgICAgIHN3aXRjaCAoZGF0YS5jbWQpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ2NsaWVudEluZm8nOgogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnByb3RvY29sVmVyc2lvbiAhPT0gY29tbW9uXzEuUkVNT1RFX1BST1RPQ09MX1ZFUlNJT04pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cud2FybihgUHJvdG9jb2wgdmVyc2lvbiAke2RhdGEucHJvdG9jb2xWZXJzaW9ufSBmcm9tIHRoZSBhZGFwdGVyIGRvZXMgbm90IG1hdGNoIHRoZSByZW1vdGUgY2xpZW50IHByb3RvY29sIHZlcnNpb24gJHtjb21tb25fMS5SRU1PVEVfUFJPVE9DT0xfVkVSU0lPTn0hIFBsZWFzZSByZWluc3RhbGwgdGhlIHJlbW90ZSBjbGllbnQuYCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLmluZm8oJ1NlbmRpbmcgY2xpZW50IGluZm8gdG8gdGhlIGFkYXB0ZXInKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmQoewogICAgICAgICAgICAgICAgICAgICAgICBjbWQ6ICdjbGllbnRJbmZvJywKICAgICAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2xWZXJzaW9uOiBjb21tb25fMS5SRU1PVEVfUFJPVE9DT0xfVkVSU0lPTiwKICAgICAgICAgICAgICAgICAgICAgICAgc3lzdGVtSWQ6IHRoaXMuc3lzdGVtSWQsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdyZWFkJzoKICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEuYWRkcmVzcykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZy53YXJuKGBHb3QgcmVhZCBjb21tYW5kIHdpdGhvdXQgYWRkcmVzcyBmcm9tIGFkYXB0ZXIhYCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbGV0IHJhdzsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICByYXcgPSB5aWVsZCByZWFkRmlsZShgJHt0aGlzLncxRGV2aWNlc1BhdGh9LyR7ZGF0YS5hZGRyZXNzfS93MV9zbGF2ZWAsICd1dGY4Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKGBSZWFkIGZyb20gZmlsZSAke3RoaXMudzFEZXZpY2VzUGF0aH0vJHtkYXRhLmFkZHJlc3N9L3cxX3NsYXZlOmAsIHJhdyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cud2FybihgUmVhZCBmcm9tIGZpbGUgJHt0aGlzLncxRGV2aWNlc1BhdGh9LyR7ZGF0YS5hZGRyZXNzfS93MV9zbGF2ZSBmYWlsZWQhICR7ZXJyLnRvU3RyaW5nKCl9YCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKGVycik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhdyA9ICcnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLnNlbmQoewogICAgICAgICAgICAgICAgICAgICAgICBjbWQ6ICdyZWFkJywKICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzczogZGF0YS5hZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICAgICB0czogZGF0YS50cywKICAgICAgICAgICAgICAgICAgICAgICAgcmF3LAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnc2VhcmNoJzoKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlcyA9IHlpZWxkIHJlYWREaXIodGhpcy53MURldmljZXNQYXRoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvbXMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlc1tpXS5tYXRjaCgvXncxX2J1c19tYXN0ZXJcZCskLykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKGByZWFkaW5nICR7dGhpcy53MURldmljZXNQYXRofS8ke2ZpbGVzW2ldfS93MV9tYXN0ZXJfc2xhdmVzYCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9tcy5wdXNoKHJlYWRGaWxlKGAke3RoaXMudzFEZXZpY2VzUGF0aH0vJHtmaWxlc1tpXX0vdzFfbWFzdGVyX3NsYXZlc2AsICd1dGY4JykpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFkZHJlc3NlcyA9ICh5aWVsZCBQcm9taXNlLmFsbChwcm9tcykpLnJlZHVjZSgoYWNjLCBjdXIpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjYy5wdXNoKC4uLmN1ci50cmltKCkuc3BsaXQoJ1xuJykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgW10pOwogICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLnNlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY21kOiAnc2VhcmNoJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRzOiBkYXRhLnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3lzdGVtSWQ6IGRhdGEuc3lzdGVtSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzZXMKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cud2FybihgU2VhcmNoaW5nIGZvciBzZW5zb3JzIGZhaWxlZCEgJHtlcnIudG9TdHJpbmcoKX1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cuZGVidWcoZXJyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLndhcm4oYFVua25vd24gY29tbWFuZCBmcm9tIGFkYXB0ZXJgKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgb25FcnJvcihlcnIpIHsKICAgICAgICB0aGlzLmxvZy53YXJuKGBTb2NrZXQgZXJyb3I6YCwgZXJyLnRvU3RyaW5nKCkpOwogICAgICAgIHRoaXMubG9nLmRlYnVnKGVycik7CiAgICAgICAgdGhpcy5zb2NrZXQuZW5kKCk7CiAgICAgICAgdGhpcy5yZWNvbm5lY3QoKTsKICAgIH0KICAgIG9uQ2xvc2UoKSB7CiAgICAgICAgdGhpcy5sb2cuaW5mbygnU29ja2V0IGNsb3NlZCcpOwogICAgICAgIHRoaXMucmVjb25uZWN0KCk7CiAgICB9CiAgICByZWNvbm5lY3QoKSB7CiAgICAgICAgaWYgKCF0aGlzLnJlY29ubmVjdFRpbWVvdXQgJiYgIXRoaXMuc2hvdWxkRXhpdCkgewogICAgICAgICAgICB0aGlzLmxvZy5pbmZvKGBSZWNvbm5lY3QgaW4gMzAgc2Vjb25kc2ApOwogICAgICAgICAgICB0aGlzLnJlY29ubmVjdFRpbWVvdXQgPSBzZXRUaW1lb3V0KHRoaXMuY29ubmVjdCwgMzAwMDApOwogICAgICAgIH0KICAgIH0KICAgIHNlbmQoZGF0YSkgewogICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7CiAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKCdzZW5kIHRvIGFkYXB0ZXI6JywgZGF0YSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC53cml0ZSgoMCwgY29tbW9uXzEuZW5jcnlwdCkoSlNPTi5zdHJpbmdpZnkoZGF0YSksIHRoaXMuYWRhcHRlcktleSkgKyAnXG4nLCAoZXJyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CiAgICByZWFkRG90RW52KCkgewogICAgICAgIGlmICghZnMuZXhpc3RzU3luYygnLmVudicpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgbGV0IGRhdGE7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZGF0YSA9IGZzLnJlYWRGaWxlU3luYygnLmVudicsICd1dGYtOCcpLnNwbGl0KCdcbicpLm1hcCgobCkgPT4gbC50cmltKCkpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKCdjYW5cJ3QgcmVhZCAuZW52IGZpbGUnLCBlcnIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBkYXRhKSB7CiAgICAgICAgICAgIGlmICghbGluZSB8fCBsaW5lLnN0YXJ0c1dpdGgoJyMnKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjb25zdCBpZHggPSBsaW5lLmluZGV4T2YoJz0nKTsKICAgICAgICAgICAgaWYgKGlkeCA8PSAwKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IGxpbmUuc2xpY2UoMCwgaWR4KS50cmltKCk7CiAgICAgICAgICAgIGNvbnN0IHZhbCA9IGxpbmUuc2xpY2UoaWR4ICsgMSkudHJpbSgpLnJlcGxhY2UoLyheInwiJCkvZywgJycpOwogICAgICAgICAgICBpZiAoRU5WX0tFWVMuaW5kZXhPZihrZXkpID49IDApIHsKICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudltrZXldKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnZba2V5XSA9IHZhbDsKICAgICAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKGByZWFkICR7a2V5fT0ke3ZhbH0gZnJvbSAuZW52IGZpbGVgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGV4aXQoKSB7CiAgICAgICAgdGhpcy5zaG91bGRFeGl0ID0gdHJ1ZTsKICAgICAgICBpZiAodGhpcy5yZWNvbm5lY3RUaW1lb3V0KSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJlY29ubmVjdFRpbWVvdXQpOwogICAgICAgIH0KICAgICAgICB0aGlzLnNvY2tldC5lbmQoKTsKICAgIH0KfQpuZXcgRHMxOGIyMFJlbW90ZSgpOwovLyMgc291cmNlTWFwcGluZ1VSTD1kczE4YjIwLXJlbW90ZS1jbGllbnQuanMubWFw',
'logger.js': 'InVzZSBzdHJpY3QiOwpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwpleHBvcnRzLkxvZ2dlciA9IHZvaWQgMDsKY2xhc3MgTG9nZ2VyIHsKICAgIGxvZyguLi5hcmdzKSB7CiAgICAgICAgY29uc29sZS5sb2coLi4uYXJncyk7CiAgICB9CiAgICBkZWJ1ZyguLi5hcmdzKSB7CiAgICAgICAgaWYgKCFwcm9jZXNzLmVudi5ERUJVRykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKCdbRGVidWddJywgLi4uYXJncyk7CiAgICB9CiAgICBpbmZvKC4uLmFyZ3MpIHsKICAgICAgICBjb25zb2xlLmxvZygnW0luZm9dJywgLi4uYXJncyk7CiAgICB9CiAgICB3YXJuKC4uLmFyZ3MpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1tXYXJuXScsIC4uLmFyZ3MpOwogICAgfQogICAgZXJyb3IoLi4uYXJncykgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tFcnJvcl0nLCAuLi5hcmdzKTsKICAgIH0KfQpleHBvcnRzLkxvZ2dlciA9IExvZ2dlcjsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9bG9nZ2VyLmpzLm1hcA=='
};
for (const f in files) {
    const content = Buffer.from(files[f], 'base64').toString('utf-8');
    fs.writeFileSync(f, content, { encoding: 'utf-8' });
}
const systemDContent = `[Unit]
Description=ioBroker.ds18b20 remote client
Documentation=https://github.com/crycode-de/ioBroker.ds18b20
After=network.target

[Service]
Type=simple
User=${os.userInfo().username}
WorkingDirectory=${__dirname}
ExecStart=${process.execPath} ${path.join(__dirname, 'ds18b20-remote-client.js')}
Restart=on-failure

[Install]
WantedBy=multi-user.target
`;
const systemDFile = path.join(__dirname, SYSTEMD_SERVICE_NAME);
fs.writeFileSync(systemDFile, systemDContent, { encoding: 'utf-8' });
const dotEnvContent = `# Settings for the ioBroker.ds18b20 remote client

# Unique ID for this remote system
SYSTEM_ID=my-remote

# IP or hostname of the ioBroker host running the adapter
ADAPTER_HOST=

# Port from the adapter config
ADAPTER_PORT=1820

# Encryption key from the adapter config
ADAPTER_KEY=

# Enable debug log output
#DEBUG=1

# System path of the 1-wire devices
#W1_DEVICES_PATH=/sys/bus/w1/devices
`;
const dotEnvFile = path.join(__dirname, '.env');
if (!fs.existsSync(dotEnvFile)) {
    fs.writeFileSync(dotEnvFile, dotEnvContent, { encoding: 'utf-8' });
}
console.log(`- ioBroker.ds18b20 remote client -

Basic setup done.

Please adjust the settings in the .env file.

To manually start the client just run:
  node ds18b20-remote-client.js

To setup the SystemD service, please run:
  sudo cp ${SYSTEMD_SERVICE_NAME} /etc/systemd/system/${SYSTEMD_SERVICE_NAME}
  sudo systemctl daemon-reload
  sudo systemctl enable ${SYSTEMD_SERVICE_NAME}
  sudo systemctl start ${SYSTEMD_SERVICE_NAME}
`);
//# sourceMappingURL=setup.js.map